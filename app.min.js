$(function(){n={};n.nextOrder=function(){};var e=Backbone.Model.extend({defaults:function(){return{title:null,url:null,created:new Date,order:n.nextOrder(),done:false}},initialize:function(){if(!this.get("title")){this.set({title:this.defaults().title})}if(!this.get("url")){this.set({url:this.defaults().url})}},toggle:function(){this.save({done:!this.get("done")})},details_from_chrome:function(e){var t=this;chrome.tabs.query({active:true,windowId:chrome.windows.WINDOW_ID_CURRENT},function(e){var n=e[0];t.set({title:n.title});t.set({url:n.url})});return this}});var t=Backbone.Collection.extend({model:e,localStorage:new Backbone.LocalStorage("bookmarks-bookmarks"),done:function(){return this.filter(function(e){return e.get("done")})},remaining:function(){return this.without.apply(this,this.done())},nextOrder:function(){if(!this.length)return 1;return this.last().get("order")+1},comparator:function(e){return-(new Date(e.get("created"))).getTime()}});var n=new t;var r=Backbone.View.extend({tagName:"li",template:function(e){var t='<label class="checkbox">';t=t+'<input class="toggle" type="checkbox" '+(e.done?'checked="checked"':"")+"/>";t=t+'<a class="link" href='+_.escape(e.url)+">"+_.escape(e.title)+'</a><a href="" class="destroy"><i class="icon-remove"></i></a>';t=t+"</label>";t=t+"<label><small><em>url: "+_.escape(e.url)+"</small></em></label>";return t},events:{"click .toggle":"toggleDone","click #edit":"edit","click .link":"navigate","click a.destroy":"clear","keypress .edit":"updateOnEnter","blur .edit":"close"},initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.toggleClass("done",this.model.get("done"));this.input=this.$(".edit");return this},toggleDone:function(){this.model.toggle()},edit:function(e){e.preventDefault();this.$el.addClass("editing");this.input.focus()},close:function(){var e=this.input.val();if(!e){this.clear()}else{this.model.save({title:e});this.$el.removeClass("editing")}},updateOnEnter:function(e){if(e.keyCode==13)this.close()},clear:function(e){e.preventDefault();this.model.destroy()},navigate:function(e){e.preventDefault();chrome.tabs.update(null,{url:this.model.get("url")})}});var i=Backbone.View.extend({el:$("#todoapp"),statsTemplate:function(e){var t="";if(e.done){t=t+'<a id="clear-completed"><button class="btn">Clear '+e.done+" completed "+(e.done==1?"item":"items")+"</button></a>"}t=t+'<div class="todo-count"><b>'+e.remaining+"</b> "+(e.remaining==1?"item":"items")+" left</div>";t=t+'<div id="credits">Created by Eoin Murray. Source on <a class="external" href="http://github.com/eoinmurray"><i class="icon-github "></i></a></div>';return t},events:{"keypress #new-todo":"createOnEnter","click .save":"createOnSave","click #clear-completed":"clearCompleted","click #toggle-all":"toggleAllComplete","click .external":"external"},initialize:function(){this.model=new e;this.model.details_from_chrome();this.model.on("change",function(){this.render()},this);this.input=this.$("#new-todo");this.input_url=this.$("#url");this.allCheckbox=this.$("#toggle-all")[0];n.on("add",this.addOne,this);n.on("reset",this.addAll,this);n.on("all",this.render,this);this.footer=this.$("footer");this.main=$("#main");n.fetch()},render:function(){var e=n.done().length;var t=n.remaining().length;this.input.val(this.model.get("title"));this.input_url.text(this.model.get("url")||"the url will appear here");if(n.length){this.main.show();this.footer.show();this.footer.html(this.statsTemplate({done:e,remaining:t}))}else{this.main.hide();this.footer.hide()}this.allCheckbox.checked=!t},addOne:function(e){var t=new r({model:e});this.$("#todo-list").append(t.render().el)},addAll:function(){n.each(this.addOne,this)},createOnEnter:function(e){if(e.keyCode!=13)return;if(!this.input.val())return;console.log(this.model.get("url"));n.create(this.model);this.render()},createOnSave:function(e){e.preventDefault();if(!this.input.val())return;n.create(this.model);this.render()},clearCompleted:function(){_.invoke(n.done(),"destroy");return false},toggleAllComplete:function(){var e=this.allCheckbox.checked;n.each(function(t){t.save({done:e})})},external:function(e){e.preventDefault();chrome.tabs.update(null,{url:e.currentTarget.href})}});var s=new i})